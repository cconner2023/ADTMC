const a="adtmc-cache-v2.6",s="/ADTMC/";const r=[{"revision":"322bd41ccaf37ebf4993400809f6ccb8","url":"registerSW.js"},{"revision":"be37bf300f85186fcc35bd7212b49a03","url":"manifest.json"},{"revision":"de7769e44ace52a1cd00c2a26c94557f","url":"index.html"},{"revision":"b2194a7c346b97746b127f2d0d9b13aa","url":"icon-512.png"},{"revision":"b2194a7c346b97746b127f2d0d9b13aa","url":"icon-512-maskable.png"},{"revision":"bbc951fe177cbc880153d776bad72641","url":"icon-192.png"},{"revision":"390685e39dd217b4fb4ec6557f694306","url":"icon-144.png"},{"revision":null,"url":"assets/index-CFtlm7lu.css"},{"revision":null,"url":"assets/index-BQmGwUZb.js"}],d=[s,s+"index.html",s+"manifest.json"];self.addEventListener("install",e=>{console.log("[Service Worker] Installing version:","v3"),self.skipWaiting(),e.waitUntil(caches.open(a).then(t=>{console.log("[Service Worker] Caching critical assets");const c=[...d];return r&&Array.isArray(r)&&r.forEach(o=>{const n=typeof o=="string"?o:o.url;n&&!c.includes(n)&&c.push(n)}),t.addAll(c.map(o=>new Request(o,{cache:"reload"})))}).then(()=>{console.log("[Service Worker] Install completed")}))});self.addEventListener("activate",e=>{console.log("[Service Worker] Activating"),e.waitUntil(caches.keys().then(t=>Promise.all(t.map(c=>{if(c!==a&&c.startsWith("adtmc-cache-"))return console.log("[Service Worker] Deleting old cache:",c),caches.delete(c)}))).then(()=>self.clients.claim()).then(()=>{console.log("[Service Worker] Activation completed"),self.clients.matchAll().then(t=>{t.forEach(c=>{c.postMessage({type:"SW_READY",version:"v3",cacheName:a})})})}))});self.addEventListener("fetch",e=>{if(e.request.method!=="GET")return;const t=new URL(e.request.url);t.origin===self.location.origin&&t.protocol!=="chrome-extension:"&&(e.request.destination==="document"||t.pathname.endsWith(".html")||t.pathname===s||t.pathname===s.slice(0,-1)?e.respondWith(f(e.request).catch(()=>caches.match(e.request))):e.request.destination==="script"||e.request.destination==="style"||t.pathname.endsWith(".js")||t.pathname.endsWith(".css")?e.respondWith(p(e.request)):e.respondWith(u(e.request)))});async function f(e){try{const t=await fetch(e);if(t.ok){const c=t.clone();caches.open(a).then(o=>{o.put(e,c).then(()=>{i(e,t)})})}return t}catch(t){throw console.log("[Service Worker] Network failed for:",e.url,t),t}}async function p(e){const t=await caches.open(a),c=await t.match(e),o=fetch(e).then(n=>(n.ok&&(t.put(e,n.clone()),i(e,n)),n)).catch(()=>{});return c||o}async function u(e){const t=await caches.open(a),c=await t.match(e);return c?(fetch(e).then(o=>{o.ok&&(t.put(e,o.clone()),i(e,o))}).catch(()=>{}),c):fetch(e)}async function i(e,t){try{const o=await(await caches.open(a)).match(e);if(o){const[n,l]=await Promise.all([o.text(),t.clone().text()]);n!==l&&(console.log("[Service Worker] Content updated:",e.url),(await self.clients.matchAll()).forEach(h=>{h.postMessage({type:"CONTENT_UPDATED",url:e.url,version:"v3",timestamp:new Date().toISOString()})}))}}catch(c){console.log("[Service Worker] Error checking content update:",c)}}self.addEventListener("message",e=>{e.data==="skipWaiting"&&self.skipWaiting(),e.data==="checkForUpdates"&&self.registration.update(),e.data.type==="CLEAR_CACHE"&&caches.delete(a).then(()=>{console.log("[Service Worker] Cache cleared by user request"),e.ports?.[0]?.postMessage({success:!0})}),e.data.type==="GET_CACHE_INFO"&&caches.open(a).then(t=>{t.keys().then(c=>{e.ports?.[0]?.postMessage({cacheName:a,cacheSize:c.length,version:"v3"})})})});"periodicSync"in self.registration&&self.addEventListener("periodicsync",e=>{e.tag==="update-check"&&e.waitUntil(g())});async function g(){console.log("[Service Worker] Performing periodic update check");try{const e=await caches.open(a),t=await e.keys();for(const c of t)try{const o=await fetch(c);o.ok&&await e.put(c,o.clone())}catch{}console.log("[Service Worker] Update check completed")}catch(e){console.log("[Service Worker] Update check failed:",e)}}"backgroundFetch"in self&&self.addEventListener("backgroundfetchsuccess",e=>{console.log("[Service Worker] Background fetch succeeded:",e.registration.id)});
